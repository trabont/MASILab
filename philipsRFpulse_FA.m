function [B1,t] = philipsRFpulse_FA(FA,pw,shape)
% FA - Flip Angle (degrees)
% pw - pulse width (sec)
% shape: 'am_sg_300_100_0', 'am_sg_400_150_125' 

% Check B1 amp dim
if size(FA,1) ~= 1
    FA = FA';
end

FA = FA*pi/180;

% Get shape of RF pulse
switch shape
    case 'am_sg_300_100_0'
        B1s = [   0;   411;   841;  1274;  1694;  2084;  2427;  2705;  2903;  3005;    
               3001;  2881;  2641;  2277;  1795;  1201;   509;  -266; -1101; -1970;          
              -2845; -3693; -4481; -5174; -5737; -6136; -6341; -6322; -6056; -5525;   
              -4716; -3624; -2251;  -606;  1294;  3424;  5752;  8240; 10845; 13517;                 
              16205; 18855; 21411; 23819; 26027; 27987; 29654; 30993; 31971; 32567;   
              32767; 32567; 31971; 30993; 29654; 27987; 26027; 23819; 21411; 18855;   
              16205; 13517; 10845;  8240;  5752;  3424;  1294;  -606; -2251; -3624;        
              -4716; -5525; -6056; -6322; -6341; -6136; -5737; -5174; -4481; -3693;   
              -2845; -1970; -1101;  -266;   509;  1201;  1795;  2277;  2641;  2881;          
               3001;  3005;  2903;  2705;  2427;  2084;  1694;  1274;   841;   411; 
                  0                                                                ];   
              
    case 'am_sg_400_150_125' 
        B1s = [   0;   47;    96;   147;   200;   253;   305;   355;   403;   448;
               487;   521;   548;   567;   577;   578;   569;   549;   518;   476;
               422;   358;   283;   197;   103;     0;  -110;  -225;  -343;  -464;
              -584;  -703;  -816;  -923; -1021; -1108; -1181; -1237; -1277; -1296;
             -1294; -1270; -1222; -1150; -1053;  -933;  -788;  -621;  -432;  -225;
                 0;   239;   488;   744;  1003;  1262;  1514;  1756;  1983;  2190;
              2372;  2524;  2643;  2724;  2763;  2757;  2703;  2600;  2446;  2240;
              1983;  1676;  1320;   920;   478;     0;  -509; -1042; -1593; -2152;
             -2712; -3263; -3795; -4298; -4763; -5178; -5535; -5821; -6029; -6150;
             -6173; -6093; -5902; -5595; -5168; -4617; -3941; -3139; -2213; -1165;
                 0;  1276;  2657;  4132;  5692;  7326;  9021; 10762; 12536; 14327;
             16119; 17896; 19641; 21338; 22970; 24522; 25977; 27323; 28544; 29629;
        	 30567; 31348; 31964; 32409; 32677; 32767; 32677; 32409; 31964; 31348;
             30567; 29629; 28544; 27323; 25977; 24522; 22970; 21338; 19641; 17896;
             16119; 14327; 12536; 10762;  9021;  7326;  5692;  4132;  2657;  1276;
                 0; -1165; -2213; -3139; -3941; -4617; -5168; -5595; -5902; -6093;
             -6173; -6150; -6029; -5821; -5535; -5178; -4763; -4298; -3795; -3263;
             -2712; -2152; -1593; -1042;  -509;     0;   478;   920;  1320;  1676;
             1983;   2240;  2446;  2600;  2703;  2757;  2763;  2724;  2643;  2524;
             2372;   2190;  1983;  1756;  1514;  1262;  1003;   744;   488;   239;
             0                                                                    ];
         
   case 'am_sg_100_100_0'    
         B1s = [0;     413;   859;   1337;  1847;  2389;  2962;  3568;  4204;  4870; 
                5565;  6288;  7038;  7814;  8613;  9435;  10277; 11138; 12015; 12906; 
                13809; 14721; 15640; 16563; 17487; 18409; 19327; 20237; 21136; 22023;
                22892; 23742; 24570; 25372; 26146; 26889; 27598; 28271; 28905; 29497;
                30046; 30549; 31005; 31411; 31767; 32070; 32320; 32515; 32655; 32739;
                32767; 32739; 32655; 32515; 32320; 32070; 31767; 31411; 31005; 30549;
                30046; 29497; 28905; 28271; 27598; 26889; 26146; 25372; 24570; 23742;
                22892; 22023; 21136; 20237; 19327; 18409; 17487; 16563; 15640; 14721;
                13809; 12906; 12015; 11138; 10277; 9435;  8613;  7814;  7038;  6288;
                5565;  4870;  4204;  3568;  2962;  2389;  1847;  1337;  859;   413;
                0                                                                    ];
        case 'am_sg_150_100_167'
        B1s = [66; -138; -359; -595; -845; -1107; -1378; -1658; -1943; -2230;
               -2517; -2800; -3076; -3341; -3592; -3824; -4034; -4217; -4370;
               -4488; -4567; -4602; -4591; -4530; -4414; -4240; -4007; -3710;
               -3348; -2918; -2421; -1853; -1216; -510; 266; 1110; 2019; 2991;
               4024; 5114; 6256; 7446; 8678; 9947; 11247; 12571; 13911; 15262;
               16614; 17960; 19293; 20604; 21885; 23129; 24326; 25471; 26554;
               27570; 28511; 29371; 30144; 30826; 31410; 31894; 32274; 32547;
               32712; 32767; 32712; 32547; 32274; 31894; 31410; 30826; 30144;
               29371; 28511; 27570; 26554; 25471; 24326; 23129; 21885; 20604;
               19293; 17960; 16614; 15262; 13911; 12571; 11247; 9947; 8678;
               7446; 6256; 5114; 4024; 2991; 2019; 1110; 266];
    case 'square'
        B1s = [0;     ones(99,1); 0];

end

% Calulate pulse based B1amp amd pw
t = zeros(length(B1s),length(FA));

for ii = 1:length(FA)
    t(:,ii) = linspace(0,pw(ii),length(B1s));
end
gam = 42.58*2*pi; %(rad/s-uT)

tim = pw/length(B1s);

% Generate B1 guesses (uT)

B1g = 0:0.01:20;

alphg = zeros(length(B1g),length(FA));
tmp1 = zeros(size(FA));
for jj = 1:length(FA)
    for ii = 1:length(B1g)
        tmp = B1g(ii)*(B1s/max(B1s));
        
        alphg(ii,jj) = gam*trapz(t(:,jj),tmp);
    end
    tmp1(jj) = interp1(alphg(:,jj),B1g,FA(jj));
end


B1 = (B1s/max(B1s))*tmp1;

end


